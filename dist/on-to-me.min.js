export function getPreviousSib(t){let e=t;for(;e&&e.hasAttribute("on");)e=e.previousElementSibling||t.parentElement;return e}export function nudge(t){const e=t.getAttribute("disabled");null!==e&&(0===e.length||"1"===e?t.removeAttribute("disabled"):t.setAttribute("disabled",(parseInt(e)-1).toString()))}export function getProp(t,e,n){let s=t,r=!0;return e.forEach((t=>{if(s&&""!==t){if(r&&"target"===t&&null===s.target)s=n._trigger;else switch(typeof t){case"string":s=s[t];break;default:s=s[t[0]].apply(s,t[1])}r=!1}})),s}export function convert(t,e){if(null===e)return t;let n=t;switch(this.parseValAs){case"bool":n="true"===t;break;case"int":n=parseInt(t);break;case"float":n=parseFloat(t);break;case"date":n=new Date(t);break;case"truthy":n=!!t;break;case"falsy":n=!t}return n}const ltcRe=/(\-\w)/g;export function lispToCamel(t){return t.replace(ltcRe,(function(t){return t[1].toUpperCase()}))}export function findMatches(t,e,n,s,r){const o=[],l=null==n?1/0:parseInt(n);let a=0;for(t=s?t.closest(s):t.nextElementSibling;null!==t;){if(t.matches(e)){if(r){const e=Array.from(t.querySelectorAll(r));o.concat(e),a+=e.length}else a++,o.push(t);if(a>l)break}t=t.nextElementSibling}return o}export function getToProp(t,e){const n=(e||t).lastIndexOf("[");return-1===n?null:lispToCamel(t.substring(n+2,t.length-1))}export function passVal(t,e,n){const s=e("to"),r=e("care-of"),o=findMatches(n,s,e("me"),e("from"),r),l=getToProp(s,r);o.forEach((e=>{e[l]=t}))}export class OnToMe extends HTMLElement{connectedCallback(){this.style.display="none";const t=getPreviousSib(this);nudge(t);const e=this._g=this.getAttribute.bind(this);t.addEventListener(e("on"),(t=>{t.stopPropagation(),this._lastEvent=t,this.handleEvent()}));const n=e("mutate-event");null!==n&&this.parentElement?.addEventListener(n,(t=>{this.handleEvent()}));const s=e("init-val");if(null!==s){let n=getProp(t,s.split("."),this);n=convert(n,e("parse-val-as")),passVal(n,e,this)}}handleEvent(){let t=getProp(this._lastEvent,this._g("val")?.split("."),this);void 0!==t&&(t=convert(t,this._g("parse-val-as")),passVal(t,this._g,this))}}const otm="on-to-me";customElements.get(otm)||customElements.define(otm,OnToMe);
